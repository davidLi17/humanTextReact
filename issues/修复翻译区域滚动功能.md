# 修复翻译区域滚动功能

## 问题描述

1. 翻译区域的自动滚动功能不生效，内容更新时无法自动滚动到底部跟随新内容
2. AI 输出时用户滚动会出现卡顿现象

## 根本原因分析

### 第一个问题：

1. **ref 绑定错误**：`internalResultAreaRef` 绑定到了 `.result-area` 元素，但实际的滚动容器是 `.result-section-wrapper`
2. **CSS 布局问题**：`.result-area` 没有设置合适的高度，导致滚动计算不准确
3. **滚动状态管理**：缺少在新翻译开始时重置用户滚动状态的逻辑

### 第二个问题：

1. **频繁的滚动事件处理**：每次滚动都触发复杂的 DOM 计算
2. **缺少事件节流**：滚动事件没有节流，在 AI 频繁输出时造成性能问题
3. **DOM 操作时机不当**：滚动操作没有使用 requestAnimationFrame 优化

## 解决方案

### 阶段 1：基础滚动功能修复

1. 将 ref 从 `internalResultAreaRef` 重命名为 `resultSectionWrapperRef`，并绑定到正确的滚动容器
2. 修改所有相关的滚动逻辑使用正确的 ref
3. 在 CSS 中为 `.result-area` 添加 `min-height: 100%` 确保正确的布局
4. 添加新的 useEffect 在翻译开始时重置用户滚动状态

### 阶段 2：滚动性能优化

1. **添加节流机制**：使用 16ms 节流限制滚动事件处理频率（60fps）
2. **使用 useCallback**：缓存滚动处理函数，避免重复创建
3. **requestAnimationFrame 优化**：使用 RAF 优化自动滚动操作
4. **智能状态重置**：添加 1 秒延迟的滚动状态重置机制
5. **内存清理**：组件卸载时清理定时器

## 修改文件

- `/entrypoints/popup/components/TranslationArea.tsx` - 修复滚动逻辑和性能优化
- `/entrypoints/popup/App.less` - 修复 CSS 样式

## 技术细节

- 滚动容器从 `.result-area` 改为 `.result-section-wrapper`
- 添加翻译状态变化时的滚动状态重置
- 16ms 节流处理滚动事件（60fps 性能）
- 使用 requestAnimationFrame 优化 DOM 操作
- 智能的滚动状态管理（1 秒延迟重置）

## 测试验证

1. ✅ 启动翻译后内容应自动滚动到底部
2. ✅ 用户手动滚动后自动滚动应停止
3. ✅ 新翻译开始时应重置滚动状态并恢复自动滚动
4. ✅ AI 输出时用户滚动应该流畅无卡顿
5. ✅ 用户停留在底部 1 秒后自动恢复跟随模式
